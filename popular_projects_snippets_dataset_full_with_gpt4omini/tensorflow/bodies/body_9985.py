# Extracted from ./data/repos/tensorflow/tensorflow/python/tools/print_selective_registration_header_test.py
default_ops = 'all'
graphs = [
    text_format.Parse(d, graph_pb2.GraphDef())
    for d in [GRAPH_DEF_TXT, GRAPH_DEF_TXT_2]
]
ops_and_kernels = selective_registration_header_lib.get_ops_and_kernels(
    'rawproto', self.WriteGraphFiles(graphs), default_ops)

header = selective_registration_header_lib.get_header_from_ops_and_kernels(
    ops_and_kernels, include_all_ops_and_kernels=True)
self.assertListEqual(
    [
        '// This file was autogenerated by %s' % self.script_name,
        '#ifndef OPS_TO_REGISTER',  #
        '#define OPS_TO_REGISTER',  #
        '#define SHOULD_REGISTER_OP(op) true',  #
        '#define SHOULD_REGISTER_OP_KERNEL(clz) true',  #
        '#define SHOULD_REGISTER_OP_GRADIENT true',  #
        '#endif'
    ],
    header.split('\n'))

self.assertListEqual(
    header.split('\n'),
    selective_registration_header_lib.get_header(
        self.WriteGraphFiles(graphs), 'rawproto', default_ops).split('\n'))
